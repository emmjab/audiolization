<!--{% include 'layout.html' %}

{% block style %}

{% endblock %}-->

<head>
  <link rel="stylesheet" href="{{ url_for('static',filename='css/style.css') }}">
  <link href='http://fonts.googleapis.com/css?family=Lato:400|Bitter:400' rel='stylesheet' type='text/css'>
  <title>Audiolyzer Test</title>
</head>

{% block content %}
<body>

<div id="layout-top">
  <h1>Audiolyzer</h1>
  <h3>Listen to your data.</h3>
</div>

<div id="viz">
</div>

<div class="container">
  <div class="row sgraph-background">
    <button id="sgraph" onclick="sgraph()">
      <img src="http://uxrepo.com/static/icon-sets/elusive/svg/play-circled2.svg" alt="Play sound graph" width="50" height="50"/>
    </button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script type="text/javascript" src="{{ url_for('static',filename='js/tones.js') }}"></script>
<script>

var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 500 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .ticks(10, "%");

var svg = d3.select("#viz").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.tsv("{{ url_for('static', filename='csv/data.tsv') }}", type, function(error, data) {
  if (error) throw error;

  x.domain(data.map(function(d) { return d.letter; }));
  y.domain([0, d3.max(data, function(d) { return d.frequency; })]);

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Frequency");

  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return x(d.letter); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.frequency); })
      .attr("height", function(d) { return height - y(d.frequency); });
});

function type(d) {
  d.frequency = +d.frequency;
  return d;
}

function sgraph() {
    tones.type = "sine";
    tones.attack = 100;
    tones.release = 100;

    var timing = 150;
    var index = 0;

    var freqs2 = [4196.59610067422,4314.62771396027,4432.55310676125,4550.26615418338,4667.66092242936,4784.63176413169,4901.07341342811,5016.88108069386,5131.95054684516,5246.17825712943,5359.46141431757,5471.69807121448,5582.78722240471,5692.62889515047,5801.12423936039,5908.17561654789,6013.68668769926,6117.56249997224,6219.70957214719,6320.03597875388,6418.45143279819,6514.86736701433,6609.19701356937,6701.35548214848,6791.25983635046,6878.82916832487,6963.9846715837,7046.64971192183,7126.74989638269,7204.21314020686,7278.96973170351,7350.95239498622,7420.0963505167,7486.33937340206,7549.62184939298,7609.8868285325,7667.08007640716,7721.1501229543,7772.04830878165,7819.72882895749,7864.14877423199,7905.26816965267,7943.05001053913,7977.46029578475,8008.46805845546,8036.0453936578,8060.16748365151,8080.81262018378,8097.96222402525,8111.60086169001,8121.71625932475,8128.29931375437,8131.34410067422,8130.84787998159,8126.81109824162,8119.23738828539,8108.13356594065,8093.50962389803,8075.37872271828,8053.75717898866,8028.66445063912,8000.12311943147,7968.15887063731,7932.80046992303,7894.07973746266,7852.03151930183,7806.69365599873,7758.10694857011,7706.31512177316,7651.36478475614,7593.30538911334,7532.18918438195,7468.07117102099,7401.00905091467,7331.06317544451,7258.29649117724,7182.7744832171,7104.56511627366,7023.7387734982,6940.36819314361,6854.52840310485,6766.29665339895,6675.75234664519,6582.97696660807,6488.0540048675,6391.06888568192,6292.1088891123,6191.26307247595,6088.62219020097,5984.27861215334,5878.32624051033,5770.86042525484,5661.97787836689,5551.77658678932,5440.35572424618,5327.81556199308,5214.25737857982,5099.78336870652,4984.4965512553,4868.50067658025,4751.90013313908,4634.79985355058,4517.30522016237,4399.52197021383,4281.55610067979,4163.51377288037,4045.50121694297,3927.62463620234,3809.9901116247,3692.70350634209,3575.87037038264,3459.59584568273,3343.98457146628,3229.14059007657,3115.16725334512,3002.16712958199,2890.24191127132,2779.49232355485,2670.01803358614,2561.91756083689,2455.288188436,2350.22587562137,2246.82517138303,2145.17912937547,2045.37922417558,1947.51526896176,1851.67533468808,1757.94567082638,1666.41062774758,1577.15258081202,1490.2518562372,1405.78665880961,1323.83300150573,1244.46463708539,1167.7529917194,1093.76710071068,1022.57354636726,954.236398082622,888.817154677601,826.374689055597,766.965195220927,710.642137708025,657.456203466958,607.455256248602,560.684293530489,517.185406022122,476.99773978617,440.15746100966,406.697723456847,376.648638633063,350.037248686398,326.887502071588,307.220231998027,291.053137681279,278.400768414983,269.27451047747,263.682576884879,261.63,263.118627003484,268.147118231507,276.710948381378,288.802410584002,304.410623339546,323.521540310053,346.117962960198,372.179556034808,401.682865859222,434.601341446009,470.905358389074,510.562245523616,553.536314327971,599.788891040879,649.278351465255,701.960158427152,757.786901856224,816.708341451574,878.671451894646,943.620470568424,1011.49694774003,1082.23979916153,1155.78536104165,1232.06744733887,1311.01740932441,1392.56419736145,1476.634424845,1563.15243424489,1652.04036519244,1743.21822454958,1836.60395839718,1932.11352587814,2029.66097482844,2129.15851912826,2230.51661770362,2333.64405510727,2438.44802360644,2544.83420670354,2652.70686401462,2761.96891742931,2872.52203847448,2984.26673680332,3097.10244972986];    
    var freqs = [261.63,281.30374,300.97748,320.65122,340.32496,359.9987,379.67244,399.34618,419.01992,438.69366,458.3674,478.04114,497.71488,517.38862,537.06236,556.7361,576.40984,596.08358,615.75732,635.43106,655.1048,674.77854,694.45228,714.12602,733.79976,753.4735,773.14724,792.82098,812.49472,832.16846,851.8422,871.51594,891.18968,910.86342,930.53716,950.2109,969.88464,989.55838,1009.23212,1028.90586,1048.5796,1068.25334,1087.92708,1107.60082,1127.27456,1146.9483,1166.62204,1186.29578,1205.96952,1225.64326,1245.317,1264.99074,1284.66448,1304.33822,1324.01196,1343.6857,1363.35944,1383.03318,1402.70692,1422.38066,1442.0544,1461.72814,1481.40188,1501.07562,1520.74936,1540.4231,1560.09684,1579.77058,1599.44432,1619.11806,1638.7918,1658.46554,1678.13928,1697.81302,1717.48676,1737.1605,1756.83424,1776.50798,1796.18172,1815.85546,1835.5292,1855.20294,1874.87668,1894.55042,1914.22416,1933.8979,1953.57164,1973.24538,1992.91912,2012.59286,2032.2666,2051.94034,2071.61408,2091.28782,2110.96156,2130.6353,2150.30904,2169.98278,2189.65652,2209.33026,2229.004,2248.67774,2268.35148,2288.02522,2307.69896,2327.3727,2347.04644,2366.72018,2386.39392,2406.06766,2425.7414,2445.41514,2465.08888,2484.76262,2504.43636,2524.1101,2543.78384,2563.45758,2583.13132,2602.80506,2622.4788,2642.15254,2661.82628,2681.50002,2701.17376,2720.8475,2740.52124,2760.19498,2779.86872,2799.54246,2819.2162,2838.88994,2858.56368,2878.23742,2897.91116,2917.5849,2937.25864,2956.93238,2976.60612,2996.27986,3015.9536,3035.62734,3055.30108,3074.97482,3094.64856,3114.3223,3133.99604,3153.66978,3173.34352,3193.01726,3212.691,3232.36474,3252.03848,3271.71222,3291.38596,3311.0597,3330.73344,3350.40718,3370.08092,3389.75466,3409.4284,3429.10214,3448.77588,3468.44962,3488.12336,3507.7971,3527.47084,3547.14458,3566.81832,3586.49206,3606.1658,3625.83954,3645.51328,3665.18702,3684.86076,3704.5345,3724.20824,3743.88198,3763.55572,3783.22946,3802.9032,3822.57694,3842.25068,3861.92442,3881.59816,3901.2719,3920.94564,3940.61938,3960.29312,3979.96686,3999.6406,4019.31434,4038.98808,4058.66182,4078.33556,4098.0093,4117.68304,4137.35678,4157.03052,4176.70426,4196.378,4176.70426,4157.03052,4137.35678,4117.68304,4098.0093,4078.33556,4058.66182,4038.98808,4019.31434,3999.6406,3979.96686,3960.29312,3940.61938,3920.94564,3901.2719,3881.59816,3861.92442,3842.25068,3822.57694,3802.9032,3783.22946,3763.55572,3743.88198,3724.20824,3704.5345,3684.86076,3665.18702,3645.51328,3625.83954,3606.1658,3586.49206,3566.81832,3547.14458,3527.47084,3507.7971,3488.12336,3468.44962,3448.77588,3429.10214,3409.4284,3389.75466,3370.08092,3350.40718,3330.73344,3311.0597,3291.38596,3271.71222,3252.03848,3232.36474,3212.691,3193.01726,3173.34352,3153.66978,3133.99604,3114.3223,3094.64856,3074.97482,3055.30108,3035.62734,3015.9536,2996.27986,2976.60612,2956.93238,2937.25864,2917.5849,2897.91116,2878.23742,2858.56368,2838.88994,2819.2162,2799.54246,2779.86872,2760.19498,2740.52124,2720.8475,2701.17376,2681.50002,2661.82628,2642.15254,2622.4788,2602.80506,2583.13132,2563.45758,2543.78384,2524.1101,2504.43636,2484.76262,2465.08888,2445.41514,2425.7414,2406.06766,2386.39392,2366.72018,2347.04644,2327.3727,2307.69896,2288.02522,2268.35148,2248.67774,2229.004,2209.33026,2189.65652,2169.98278,2150.30904,2130.6353,2110.96156,2091.28782,2071.61408,2051.94034,2032.2666,2012.59286,1992.91912,1973.24538,1953.57164,1933.8979,1914.22416,1894.55042,1874.87668,1855.20294,1835.5292,1815.85546,1796.18172,1776.50798,1756.83424,1737.1605,1717.48676,1697.81302,1678.13928,1658.46554,1638.7918,1619.11806,1599.44432,1579.77058,1560.09684,1540.4231,1520.74936,1501.07562,1481.40188,1461.72814,1442.0544,1422.38066,1402.70692,1383.03318,1363.35944,1343.6857,1324.01196,1304.33822,1284.66448,1264.99074,1245.317,1225.64326,1205.96952,1186.29578,1166.62204,1146.9483,1127.27456,1107.60082,1087.92708,1068.25334,1048.5796,1028.90586,1009.23212,989.55838,969.88464,950.2109,930.53716,910.86342,891.18968,871.51594,851.8422,832.16846,812.49472,792.82098,773.14724,753.4735,733.79976,714.12602,694.45228,674.77854,655.104799999999,635.43106,615.757319999999,596.08358,576.40984,556.7361,537.06236,517.38862,497.71488,478.04114,458.3674,438.69366,419.01992,399.34618,379.67244,359.9987,340.32496,320.65122,300.97748,281.30374,261.63,281.30374,300.977480000001,320.65122,340.32496,359.9987,379.672440000001,399.346180000001,419.01992,438.69366,458.367399999999,478.041140000001,497.71488,517.38862,537.062359999999,556.736100000001,576.40984,596.08358,615.757319999999,635.431060000001,655.1048,674.77854,694.45228,714.126020000001,733.79976,753.4735,773.14724,792.820980000001,812.49472,832.16846,851.8422,871.515940000001,891.189680000001,910.86342,930.53716,950.210900000001,969.884640000001,989.55838,1009.23212,1028.90586,1048.5796,1068.25334,1087.92708,1107.60082,1127.27456,1146.9483,1166.62204,1186.29578,1205.96952,1225.64326,1245.317,1264.99074,1284.66448,1304.33822,1324.01196,1343.6857,1363.35944,1383.03318,1402.70692,1422.38066,1442.0544,1461.72814,1481.40188,1501.07562,1520.74936,1540.4231,1560.09684,1579.77058,1599.44432,1619.11806,1638.7918,1658.46554,1678.13928,1697.81302,1717.48676,1737.1605,1756.83424,1776.50798,1796.18172,1815.85546,1835.5292,1855.20294,1874.87668,1894.55042,1914.22416,1933.8979,1953.57164,1973.24538,1992.91912,2012.59286,2032.2666,2051.94034,2071.61408,2091.28782,2110.96156,2130.6353,2150.30904,2169.98278,2189.65652,2209.33026,2229.004,2248.67774,2268.35148,2288.02522,2307.69896,2327.3727,2347.04644,2366.72018,2386.39392,2406.06766,2425.7414,2445.41514,2465.08888,2484.76262,2504.43636,2524.1101,2543.78384,2563.45758,2583.13132,2602.80506,2622.4788,2642.15254,2661.82628,2681.50002,2701.17376,2720.8475,2740.52124,2760.19498,2779.86872,2799.54246,2819.2162,2838.88994,2858.56368,2878.23742,2897.91116,2917.5849,2937.25864,2956.93238,2976.60612,2996.27986,3015.9536,3035.62734,3055.30108,3074.97482,3094.64856,3114.3223,3133.99604,3153.66978,3173.34352,3193.01726,3212.691,3232.36474,3252.03848,3271.71222,3291.38596,3311.0597,3330.73344,3350.40718,3370.08092,3389.75466,3409.4284,3429.10214,3448.77588,3468.44962,3488.12336,3507.7971,3527.47084,3547.14458,3566.81832,3586.49206,3606.1658,3625.83954,3645.51328,3665.18702,3684.86076,3704.5345,3724.20824,3743.88198,3763.55572,3783.22946,3802.9032,3822.57694,3842.25068,3861.92442,3881.59816,3901.2719,3920.94564,3940.61938,3960.29312,3979.96686,3999.6406,4019.31434,4038.98808,4058.66182,4078.33556,4098.0093,4117.68304,4137.35678,4157.03052,4176.70426,4196.378];
    var prevTime = tones.getTimeMS();
    var elapsed = 0
    play();



    function play() {
        var now = tones.getTimeMS();
        elapsed += now - prevTime;
        if(elapsed > timing) {
            elapsed -= timing;
            var note = freqs[index]
            if(note !== 0) {
                tones.play(note);
            }
            index++;
            index %= freqs.length;
        }
        prevTime = now;
        requestAnimationFrame(play);

    }
}

</script>

</body>


{% endblock %}
